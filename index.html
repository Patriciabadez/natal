<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cartinha de Natal Animada</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            /* Cores de Natal */
            --bg-dark: #0a160a; /* Verde Escuro ainda mais profundo */
            --bg-light: #f7f9f7;
            --card-bg: #fff;
            --accent: #d32f2f; /* Vermelho Vivo um pouco mais escuro */
            --accent2: #388e3c; /* Verde Esmeralda um pouco mais escuro */
            --paper-color: #fffaf0; /* Cor de papel mais quente */
            --envelope-main: #c62828; /* Vermelho do envelope */
            --envelope-flap: #e57373; /* Aba mais clara */
        }

        /* ---------------------------------------------------- */
        /* EFEITO DE FUNDO ANIMADO (Estrelas/Part√≠culas com mais movimento) */
        /* ---------------------------------------------------- */
        body {
            font-family: 'Inter', system-ui, Segoe UI, Roboto, Arial;
            background: var(--bg-dark);
            background-image:
                radial-gradient(circle, rgba(255, 255, 255, 0.15) 1px, transparent 1px),
                radial-gradient(circle, rgba(255, 255, 255, 0.15) 1px, transparent 1px);
            background-size: 50px 50px, 80px 80px;
            background-position: 0 0, 40px 40px;
            animation: moveStars 60s linear infinite; /* Anima√ß√£o para o fundo */
            margin: 0;
            padding: 24px;
            color: #222;
            min-height: 100vh;
            overflow-x: hidden; /* Evita scroll horizontal indesejado */
        }

        @keyframes moveStars {
            from { background-position: 0 0, 40px 40px; }
            to { background-position: 1000px 1000px, 1600px 1600px; }
        }

        .app {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 20px;
        }
        header {
            grid-column: 1/-1;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--bg-light);
        }
        h1 {
            margin: 0;
            font-size: 28px; /* Fonte maior para o t√≠tulo */
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .small {
            font-size: 14px;
            color: #ccc;
        }

        /* Painel de Formul√°rio */
        .panel {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.25);
        }

        label {
            display: block;
            font-weight: 600;
            margin-top: 15px;
            font-size: 15px;
            color: #333;
        }
        input[type=text], input[type=email], textarea, input[type=file] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 6px;
            font-size: 15px;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 8px rgba(211, 47, 47, 0.3); /* Usando o valor de --accent */
            outline: none;
        }
        textarea {
            min-height: 140px;
            resize: vertical;
        }
        .images-preview{
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .thumb{
            width: 80px;
            height: 80px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--accent2);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
        }
        .thumb img{
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .controls{
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        button{
            padding: 12px 18px;
            border-radius: 8px;
            border: 0;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.1s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        /* Bot√£o principal: Visualizar Animado */
        button#viewAnimated {
            background: var(--accent);
            color: white;
            font-size: 16px;
        }
        button#viewAnimated:hover {
            background: #b71c1c;
            transform: translateY(-2px);
        }
        button.secondary {
            background: var(--accent2);
            color: white;
        }
        button.secondary:hover {
            background: #2e7d32;
            transform: translateY(-2px);
        }
        button#clear {
            background: #757575;
            color: white;
        }
        button#clear:hover {
            background: #616161;
            transform: translateY(-2px);
        }
        .hint{
            font-size: 13px;
            color: #666;
            margin-top: 8px;
        }

        /* ---------------------------------------------------- */
        /* VISUALIZA√á√ÉO DA CARTA E ANIMA√á√ÉO - O NOVO MODELO */
        /* ---------------------------------------------------- */

        /* Esconde a se√ß√£o de preview que n√£o ser√° mais usada diretamente */
        .paper-wrap {
            display: none;
        }

        .carta-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Fundo escuro */
            z-index: 1000;
            display: flex; /* Sempre flex para centralizar */
            justify-content: center;
            align-items: center;
            perspective: 1200px; /* Para efeito 3D */
            overflow-y: auto;
            opacity: 0; /* Inicia invis√≠vel */
            visibility: hidden; /* Esconde do fluxo de layout */
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .carta-overlay.is-active {
            opacity: 1;
            visibility: visible;
        }

        .envelope-container {
            position: relative;
            width: 450px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
            transition: transform 1.5s ease-in-out;
            z-index: 1; /* Garante que o envelope esteja na frente inicialmente */
        }

        .envelope-shell {
            width: 100%;
            height: 100%;
            background: var(--envelope-main);
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s ease-in-out, box-shadow 0.8s ease-in-out;
            z-index: 1;
        }

        .envelope-shell::before { /* Aba superior do envelope */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: var(--envelope-flap);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top;
            transition: transform 1s ease;
            z-index: 2;
        }

        /* Carta dentro do envelope - inicialmente oculta */
        .letter-in-envelope {
            position: absolute;
            top: 10%;
            width: 90%;
            height: 80%;
            background: var(--paper-color);
            border-radius: 8px;
            z-index: 0; /* Abaixo da aba */
            transform: translateY(0px) scale(0.95);
            transition: transform 1s ease-out 0.5s, opacity 0.5s 0.5s;
            opacity: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Anima√ß√£o: Envelope abrindo */
        .carta-overlay.open .envelope-shell::before {
            transform: rotateX(180deg) translateY(-2px); /* Aba se abre */
            background: #5a5a5a; /* Cor escura ao abrir */
        }

        /* Anima√ß√£o: Carta saindo do envelope */
        .carta-overlay.open .letter-in-envelope {
            transform: translateY(-80px) scale(1.0); /* Sobe um pouco */
            opacity: 1;
            transition-delay: 1s; /* Atraso para depois da aba abrir */
        }

        /* A carta grande que aparece na tela */
        .main-carta {
            position: fixed; /* Fixa na tela */
            top: 50%;
            left: 50%;
            width: 800px;
            max-width: 90%;
            max-height: 90vh;
            background: var(--paper-color);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            border: 8px solid var(--accent); /* Borda mais festiva */
            box-sizing: border-box;
            transform: translate(-50%, -50%) scale(0.5); /* Come√ßa pequena */
            opacity: 0;
            transition: transform 1s ease-out 1.5s, opacity 0.8s ease-out 1.5s; /* Atraso para depois da anima√ß√£o do envelope */
            z-index: 1001; /* Acima do envelope */
            overflow-y: auto;
        }

        .carta-overlay.open .main-carta {
            transform: translate(-50%, -50%) scale(1); /* Expande para o tamanho normal */
            opacity: 1;
        }

        /* Esconde o envelope depois que a carta aparece */
        .carta-overlay.open .envelope-container {
            opacity: 0;
            transition: opacity 0.5s ease 2s; /* Desaparece depois da carta aparecer */
        }
        
        /* Estilos Internos da Carta */
        .main-carta header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px dashed #ddd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .main-carta h2 {
            margin: 0;
            font-family: 'Great Vibes', cursive; /* Fonte mais elegante */
            font-size: 38px; /* Maior ainda */
            color: var(--accent);
            font-weight: 400;
        }
        .main-carta .meta {
            font-size: 15px;
            color: #555;
            margin-top: 5px;
        }
        .main-carta .message {
            margin-top: 20px;
            font-size: 19px; /* Um pouco maior */
            line-height: 1.65;
            color: #222;
            white-space: pre-wrap; /* Mant√©m quebras de linha do textarea */
        }
        .main-carta .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        .main-carta .gallery .gi{
            height: 160px;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .main-carta .gallery img{
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        .main-carta .gallery img:hover {
            transform: scale(1.05);
        }
        .footer-note {
            margin-top: 30px;
            font-size: 17px;
            color: #444;
            padding-top: 15px;
            border-top: 1px dotted #ccc;
        }

        /* Bot√£o de Fechar */
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            z-index: 1010;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.5s 2s ease, transform 0.5s 2s ease; /* Atraso para aparecer */
        }
        .close-btn:hover {
            background: #b71c1c;
            transform: scale(1);
        }
        .carta-overlay.open .close-btn {
            opacity: 1;
            transform: scale(1);
        }

        /* Bot√µes de A√ß√£o dentro da carta aberta */
        .carta-action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #eee;
        }

        @media(max-width:900px){
            .app{
                grid-template-columns: 1fr;
            }
            .carta-overlay {
                padding: 10px;
            }
            .main-carta {
                padding: 20px;
                width: 100%;
                max-width: 95%;
                margin: 0;
            }
            .envelope-container {
                width: 300px;
                height: 200px;
            }
             .main-carta h2 {
                font-size: 28px;
            }
             .main-carta .message {
                font-size: 16px;
            }
             .main-carta .gallery {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
             .main-carta .gallery .gi {
                height: 100px;
            }
            .close-btn {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><rect rx='8' ry='8' width='40' height='40' fill='%23d32f2f'/><text x='50%' y='58%' font-size='20' font-family='sans-serif' fill='white' text-anchor='middle' dominant-baseline='middle'>üíå</text></svg>" alt="logo">
            <div>
                <h1>Cartinha de Natal Animada</h1>
                <div class="small">Preencha nome, mensagem e envie at√© 10 fotos.</div>
            </div>
        </header>

        <section class="panel">
            <label for="name">Seu nome</label>
            <input id="name" placeholder="Ex: Maria Silva" />

            <label for="from">De (opcional)</label>
            <input id="from" placeholder="Ex: Fam√≠lia Silva" />

            <label for="to">Para (opcional)</label>
            <input id="to" placeholder="Ex: Jo√£o" />

            <label for="email">Email (opcional)</label>
            <input id="email" type="email" placeholder="seu@email.com" />

            <label for="message">Mensagem / Carta</label>
            <textarea id="message" placeholder="Escreva aqui a sua mensagem de Natal...">Que a magia do Natal ilumine seu cora√ß√£o com paz, amor e esperan√ßa. Que cada sorriso compartilhado renove seus sonhos e fortale√ßa sua f√©. Que o ano que chega seja leve, doce e cheio de conquistas. Feliz Natal!</textarea>

            <label for="photos">Fotos (at√© 10)</label>
            <input id="photos" type="file" accept="image/*" multiple />
            <div class="hint">Arraste/solte ou use o bot√£o. As imagens aparecer√£o na pr√©-visualiza√ß√£o.</div>
            <div class="images-preview" id="thumbs"></div>

            <div class="controls">
                <button id="viewAnimated">Visualizar Carta Animada üíå</button>
                <button id="clear">Limpar</button>
            </div>

            <div class="small" style="margin-top:10px">A visualiza√ß√£o animada reflete 100% o conte√∫do atualizado.</div>
        </section>

        </div>

    <div class="carta-overlay" id="carta-overlay">
        <div class="close-btn" id="close-btn">X</div>

        <div class="envelope-container">
            <div class="envelope-shell">
                <div class="letter-in-envelope"></div>
            </div>
        </div>

        <div class="main-carta" id="main-carta">
            <div class="carta-content">
                </div>
            <div class="carta-action-buttons">
                <button id="pdf" class="secondary">Gerar PDF</button>
                <button id="downloadHtml" class="secondary">Download HTML</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // elementos
        const nameInput = document.getElementById('name');
        const fromInput = document.getElementById('from');
        const toInput = document.getElementById('to');
        const emailInput = document.getElementById('email');
        const msgInput = document.getElementById('message');
        const photosInput = document.getElementById('photos');
        const thumbs = document.getElementById('thumbs');
        
        const cartaOverlay = document.getElementById('carta-overlay');
        const mainCarta = document.getElementById('main-carta');
        const cartaContent = mainCarta.querySelector('.carta-content');
        const letterInEnvelope = document.querySelector('.letter-in-envelope'); 

        const viewAnimatedBtn = document.getElementById('viewAnimated');
        const pdfBtn = document.getElementById('pdf');
        const downloadHtmlBtn = document.getElementById('downloadHtml');
        const clearBtn = document.getElementById('clear');
        const closeBtn = document.getElementById('close-btn');

        let images = [];

        function readFiles(fileList){
            const f = Array.from(fileList).slice(0,10);
            images = [];
            thumbs.innerHTML = '';
            f.forEach((file)=>{
                const reader = new FileReader();
                reader.onload = (e)=>{
                    const url = e.target.result;
                    images.push(url);
                    const d = document.createElement('div'); d.className='thumb';
                    const img = document.createElement('img'); img.src = url; d.appendChild(img);
                    thumbs.appendChild(d);
                };
                reader.readAsDataURL(file);
            });
        }

        photosInput.addEventListener('change', (e)=> readFiles(e.target.files));

        // Drag & drop simples na pr√≥pria janela
        document.body.addEventListener('dragover', (e)=>{ e.preventDefault(); });
        document.body.addEventListener('drop', (e)=>{ e.preventDefault(); if(e.dataTransfer.files) readFiles(e.dataTransfer.files); });

        function generateCartaHTML(){
            const name = nameInput.value.trim() || 'Amigo(a)';
            const from = fromInput.value.trim() || nameInput.value.trim() || 'Um amigo';
            const to = toInput.value.trim();
            const email = emailInput.value.trim();
            const msg = msgInput.value.trim() || 'Boas festas!';
            
            const title = to ? `Para meu querido(a) ${to}` : 'Feliz Natal!';
            let meta = name;
            if(email) meta += ' ‚Ä¢ ' + email;
            
            // Cria o HTML interno da carta
            let galleryHtml = '';
            if(images.length === 0){
                galleryHtml = `<div style="width:100%;text-align:center;color:#b08d4a;padding:30px;border-radius:8px;background:#fff8e1;border:1px dashed #ffe0b2;">Nenhuma imagem adicionada. Adicione at√© 10 para enfeitar sua cartinha!</div>`;
            } else {
                images.slice(0,10).forEach(url=>{
                    galleryHtml += `<div class="gi"><img src="${url}" alt="Foto de Natal"></div>`;
                });
            }

            return `
                <header>
                    <div>
                        <h2 id="cartaTitle">${title}</h2>
                        <div class="meta">${meta}</div>
                    </div>
                    <div style="text-align:right">
                        <div class="meta">üéÑ Dezembro, 2025</div>
                    </div>
                </header>
                <div class="message">${msg}</div>
                <div class="gallery">${galleryHtml}</div>
                <div class="footer-note">Com todo o carinho,<br><strong>${from}</strong></div>
            `;
        }
        
        // Fun√ß√£o que aciona a anima√ß√£o
        function viewAnimatedCarta() {
            // 1. Atualiza o conte√∫do da carta principal e da carta "saindo"
            const cartaContentHTML = generateCartaHTML();
            cartaContent.innerHTML = cartaContentHTML;
            letterInEnvelope.innerHTML = `<div style="padding:10px; font-size:12px; text-align:center; color:#555;">${nameInput.value || 'Mensagem'} para ${toInput.value || 'Amigo(a)'}</div>`;
            
            // 2. Reseta a classe 'open' e mostra o overlay
            cartaOverlay.classList.remove('open');
            cartaOverlay.classList.add('is-active');
            
            // 3. Aguarda um pouco e aciona a anima√ß√£o de abertura
            setTimeout(() => {
                cartaOverlay.classList.add('open');
            }, 50); // Pequeno delay para garantir que o display 'flex' seja aplicado
        }
        
        // Fecha o overlay
        function closeCarta() {
            cartaOverlay.classList.remove('open');
            // Esconde depois que a anima√ß√£o de fechamento terminar
            setTimeout(() => {
                cartaOverlay.classList.remove('is-active');
            }, 1000); // Tempo ajustado para as transi√ß√µes
        }

        viewAnimatedBtn.addEventListener('click', viewAnimatedCarta);
        closeBtn.addEventListener('click', closeCarta);
        cartaOverlay.addEventListener('click', (e) => {
            if (e.target === cartaOverlay) {
                closeCarta(); // Fecha se clicar fora da carta/envelope
            }
        });

        // ----------------------------------------------------
        // Fun√ß√µes de Download
        // ----------------------------------------------------
        
        // gerar PDF usando html2canvas + jsPDF
        pdfBtn.addEventListener('click', async ()=>{
            // Garante que o conte√∫do da carta est√° atualizado
            cartaContent.innerHTML = generateCartaHTML();

            // Clonar o main-carta para evitar interferir na visualiza√ß√£o ativa e para isolar o estilo
            const cartaForPDF = mainCarta.cloneNode(true);
            cartaForPDF.style.position = 'absolute'; // Posi√ß√£o absoluta para n√£o interferir no layout
            cartaForPDF.style.top = '-9999px'; // Fora da tela
            cartaForPDF.style.left = '-9999px';
            cartaForPDF.style.transform = 'none'; // Reseta transforma√ß√µes
            cartaForPDF.style.opacity = '1';
            cartaForPDF.style.visibility = 'visible';
            cartaForPDF.style.zIndex = '-1'; // Esconde atr√°s de tudo
            cartaForPDF.style.boxShadow = 'none'; // Remove sombra para PDF
            cartaForPDF.style.border = 'none'; // Remove borda para PDF
            cartaForPDF.style.maxWidth = 'initial';
            cartaForPDF.style.width = '800px'; // Tamanho fixo para PDF
            cartaForPDF.style.height = 'auto'; // Altura autom√°tica
            cartaForPDF.style.maxHeight = 'initial'; // Remove limite de altura

            // Remove os bot√µes de a√ß√£o que n√£o s√£o necess√°rios no PDF
            const actionButtons = cartaForPDF.querySelector('.carta-action-buttons');
            if (actionButtons) actionButtons.remove();

            // Adiciona um padding e fundo branco para o PDF
            const tempWrapper = document.createElement('div');
            tempWrapper.style.padding = '50px';
            tempWrapper.style.background = 'white';
            tempWrapper.appendChild(cartaForPDF);
            document.body.appendChild(tempWrapper);


            // Gera√ß√£o do Canvas
            const scale = 2; // melhora qualidade
            const canvas = await html2canvas(cartaForPDF, {scale, useCORS:true, scrollY:-window.scrollY});
            const imgData = canvas.toDataURL('image/jpeg', 0.95);
            
            document.body.removeChild(tempWrapper); // Remove o elemento tempor√°rio

            // Gera√ß√£o do PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({ unit: 'pt', format: 'a4', compress: true });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();

            const imgProps = { width: canvas.width, height: canvas.height };
            const ratio = Math.min(pdfWidth / imgProps.width, pdfHeight / imgProps.height);
            const imgW = imgProps.width * ratio;
            const imgH = imgProps.height * ratio;

            if(imgH <= pdfHeight){
                pdf.addImage(imgData, 'JPEG', (pdfWidth - imgW) / 2, 20, imgW, imgH);
            } else {
                 // L√≥gica de m√∫ltiplas p√°ginas
                let remainingHeight = imgProps.height;
                let position = 0;
                const pageCanvas = document.createElement('canvas');
                const pageCtx = pageCanvas.getContext('2d');
                pageCanvas.width = imgProps.width;
                pageCanvas.height = Math.floor((pdfHeight / ratio));

                while(remainingHeight > 0){
                    pageCtx.clearRect(0,0,pageCanvas.width,pageCanvas.height);
                    pageCtx.drawImage(canvas, 0, position, pageCanvas.width, pageCanvas.height, 0, 0, pageCanvas.width, pageCanvas.height);
                    const pieceData = pageCanvas.toDataURL('image/jpeg', 0.95);
                    if(position > 0) pdf.addPage();
                    pdf.addImage(pieceData, 'JPEG', (pdfWidth - imgW)/2, 20, imgW, pageCanvas.height * ratio);
                    position += pageCanvas.height;
                    remainingHeight -= pageCanvas.height;
                }
            }

            const safeName = (nameInput.value.trim() || 'cartinha').replace(/[^a-z0-9_-]/gi,'_');
            pdf.save(`${safeName}_cartinha_natal.pdf`);
        });

        // download HTML da carta (gera um arquivo .html com o conte√∫do da carta)
        downloadHtmlBtn.addEventListener('click', ()=>{
            // Garante que o conte√∫do da carta est√° atualizado
            const cartaHtmlContent = generateCartaHTML();

            // Adiciona os estilos necess√°rios para o arquivo HTML de download
            const dochtml = `<!doctype html>
                <html>
                <head>
                    <meta charset=\"utf-8\">
                    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">
                    <title>Cartinha de Natal</title>
                    <link href=\"https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700&display=swap\" rel=\"stylesheet\">
                    <style>
                        body { font-family: 'Inter', Arial, Helvetica, sans-serif; padding: 40px; background: #f7f9f7; }
                        .main-carta { max-width: 800px; margin: 0 auto; padding: 40px; border-radius: 16px; border: 8px solid #d32f2f; background: #fffaf0; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
                        .main-carta header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px dashed #ddd; padding-bottom: 15px; margin-bottom: 20px; }
                        .main-carta h2 { margin: 0; font-family: 'Great Vibes', cursive; font-size: 38px; color: #d32f2f; font-weight: 400; }
                        .main-carta .message { white-space: pre-wrap; font-size: 19px; line-height: 1.65; color: #222; margin-top: 20px; }
                        .main-carta .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin-top: 30px; }
                        .main-carta .gallery .gi { height: 160px; overflow: hidden; border-radius: 10px; }
                        .main-carta .gallery img { width: 100%; height: 100%; object-fit: cover; }
                        .footer-note { margin-top: 30px; font-size: 17px; color: #444; padding-top: 15px; border-top: 1px dotted #ccc; }
                        @media(max-width:600px){ .main-carta { padding: 20px; } .main-carta h2 { font-size: 28px; } .main-carta .gallery { grid-template-columns: 1fr; } }
                    </style>
                </head>
                <body>
                    <div class="main-carta">${cartaHtmlContent}</div>
                </body>
                </html>`;
                
            const blob = new Blob([dochtml], {type:'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = (nameInput.value.trim() || 'cartinha') + '_cartinha_natal.html'; a.click();
            URL.revokeObjectURL(url);
        });

        clearBtn.addEventListener('click', () => {
            nameInput.value = '';
            fromInput.value = '';
            toInput.value = '';
            emailInput.value = '';
            msgInput.value = 'Que a magia do Natal ilumine seu cora√ß√£o com paz, amor e esperan√ßa. Que cada sorriso compartilhado renove seus sonhos e fortale√ßa sua f√©. Que o ano que chega seja leve, doce e cheio de conquistas. Feliz Natal!';
            photosInput.value = null;
            images = [];
            thumbs.innerHTML = '';
        });
        
    </script>
</body>
</html>